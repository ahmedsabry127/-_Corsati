<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>كورساتى</title>
    <link rel="stylesheet" href="style.css">
    <!-- خطوط تدعم العربية والإنجليزية -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
</head>
<body style="font-family: 'Cairo', 'Tajawal', 'Segoe UI', Arial, sans-serif; direction: rtl; unicode-bidi: plaintext; background: none;">
<!-- تسجيل/دخول -->
<div id="auth-container" style="max-width:420px;margin:60px auto;display:none;">
    <div style="background:none;padding:0;border-radius:0;box-shadow:none;">
        <h3 style="text-align:center">مرحباً بك</h3>
        <div style="display:flex;justify-content:center;gap:8px;margin-bottom:16px;">
            <button id="show-login-btn">تسجيل الدخول</button>
            <button id="show-register-btn">تسجيل جديد</button>
        </div>
        <!-- تسجيل الدخول -->
        <form id="login-form" style="display:none;">
            <div style="margin-bottom:12px;">
                <label>البريد الإلكتروني:</label>
                <input id="login-email" type="email" style="width:100%;padding:6px;margin-top:4px;" required>
            </div>
            <div style="margin-bottom:12px;">
                <label>كلمة المرور:</label>
                <input id="login-password" type="password" style="width:100%;padding:6px;margin-top:4px;" required>
            </div>
            <div style="text-align:center;">
                <button type="submit" style="padding:6px 18px;">دخول</button>
            </div>
        </form>
        <!-- التسجيل -->
        <form id="register-form" style="display:none;">
            <div style="margin-bottom:12px;">
                <label>الاسم:</label>
                <input id="register-name" type="text" style="width:100%;padding:6px;margin-top:4px;" required>
            </div>
            <div style="margin-bottom:12px;">
                <label>البريد الإلكتروني:</label>
                <input id="register-email" type="email" style="width:100%;padding:6px;margin-top:4px;" required>
            </div>
            <div style="margin-bottom:12px;">
                <label>كلمة المرور:</label>
                <input id="register-password" type="password" style="width:100%;padding:6px;margin-top:4px;" required>
            </div>
            <div style="text-align:center;">
                <button type="submit" style="padding:6px 18px;">تسجيل</button>
            </div>
        </form>
        <div id="auth-error" style="color:red;text-align:center;margin-top:8px;"></div>
    </div>
</div>

<div id="container" style="display:none; background:none; border-radius:0; box-shadow:none; padding:0;">
    <!-- شعار الموقع وصورة الكورسات -->
    <div style="text-align:center; margin-top:32px; margin-bottom:12px;">
        <img src="صور/course.png" alt="شعار كورساتى" style="width:90px; height:90px; border-radius:18px; box-shadow:0 2px 8px #1976d211; background:#e3f0ff; display:block; margin:0 auto 10px auto;">
        <div style="font-size:2.2em; font-weight:bold; color:#1976d2; font-family:'Cairo','Tajawal','Segoe UI',Arial,sans-serif;">كورساتى</div>
    </div>
    <!-- حذف العنوان القديم -->
    <!-- <h2>مدير الملفات</h2> -->
    <div style="text-align:left;margin-bottom:8px;">
        <button id="logout-btn" style="display:none;">تسجيل الخروج</button>
    </div>
    <div id="breadcrumb"></div>
    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;">
        <button id="new-folder-btn">اضافة مجلد</button>
        <button id="add-video-btn">إضافة فيديو</button>
        <button id="add-file-btn">إضافة ملف</button>
        <button id="sort-btn">ترتيب</button> <!-- زر الترتيب الجديد -->
    </div>
    <div id="loader"></div>
    <div id="folders"></div>
</div>

<!-- Modal for add/edit -->
<div id="modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0005;z-index:1000;">
  <div id="modal" style="background:#fff;padding:24px 20px 16px 20px;border-radius:8px;max-width:340px;margin:80px auto;position:relative;box-shadow:0 2px 8px #0002;">
    <h3 id="modal-title" style="margin-top:0;text-align:center"></h3>
    <form id="modal-form">
      <!-- زر رفع الفيديو (يظهر في إضافة فيديو وأيضًا عند تعديل عنصر) -->
      <div id="upload-video-btn-row" style="display:none;margin-bottom:8px;">
        <button type="button" onclick="window.open('https://www.youtube.com/', '_blank')" style="display:flex;align-items:center;gap:6px;background:#f7fafd;color:#1976d2;border:1.5px solid #1976d2;border-radius:7px;padding:5px 12px;font-size:0.98em;cursor:pointer;">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;">
            <circle cx="10" cy="10" r="9" stroke="#1976d2" stroke-width="2"/>
            <path d="M10 14V6M10 6L7 9M10 6l3 3" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          رفع الفيديو على سيرفر 1
        </button>
        <!-- زر رفع الفيديو 2 الجديد -->
        <button type="button" onclick="window.open('https://archive.org/', '_blank')" style="display:flex;align-items:center;gap:6px;background:#f7fafd;color:#1976d2;border:1.5px solid #1976d2;border-radius:7px;padding:5px 12px;font-size:0.98em;cursor:pointer;margin-right:6px;">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;">
            <circle cx="10" cy="10" r="9" stroke="#1976d2" stroke-width="2"/>
            <path d="M10 14V6M10 6L7 9M10 6l3 3" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          رفع الفيديو على سيرفر 2
        </button>
      </div>
      <!-- زر رفع الملف (يظهر في إضافة ملف وأيضًا عند تعديل عنصر) -->
      <div id="upload-file-btn-row" style="display:none;margin-bottom:8px;">
        <button type="button" onclick="window.open('https://archive.org/', '_blank')" style="display:flex;align-items:center;gap:6px;background:#f7fafd;color:#1976d2;border:1.5px solid #1976d2;border-radius:7px;padding:5px 12px;font-size:0.98em;cursor:pointer;">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;">
            <circle cx="10" cy="10" r="9" stroke="#1976d2" stroke-width="2"/>
            <path d="M10 14V6M10 6L7 9M10 6l3 3" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          رفع الملف
        </button>
      </div>
      <div style="margin-bottom:12px;">
        <label>العنوان:</label>
        <input id="modal-name" type="text" style="width:100%;padding:6px;margin-top:4px;" required>
      </div>
      <!-- إضافة: وصف المجلد (يظهر فقط في المجلدات الفرعية) -->
      <div id="modal-folder-info-row" style="margin-bottom:12px; display:none;">
        <label>وصف المجلد:</label>
        <textarea id="modal-folder-info" style="width:100%;padding:6px;margin-top:4px;" rows="2"></textarea>
      </div>
      <div id="modal-url-row" style="margin-bottom:12px;display:none;">
        <label>الرابط:</label>
        <input id="modal-url" type="text" style="width:100%;padding:6px;margin-top:4px;">
      </div>
      <!-- إضافة: وصف الفيديو/الملف (يظهر فقط في إضافة/تعديل فيديو أو ملف) -->
      <div id="modal-item-info-row" style="margin-bottom:12px; display:none;">
        <label id="modal-item-info-label">وصف الفيديو:</label>
        <textarea id="modal-item-info" style="width:100%;padding:6px;margin-top:4px;" rows="2"></textarea>
      </div>
      <!-- خصائص المجلد الجذرى -->
      <div id="modal-root-props" style="display:none;">
        <div style="margin-bottom:12px;">
          <label>اسم المحاضر:</label>
          <input id="modal-instructor" type="text" style="width:100%;padding:6px;margin-top:4px;">
        </div>
        <!-- زر رفع الصورة الشخصية -->
        <div style="margin-bottom:4px;">
          <button type="button" onclick="window.open('https://postimages.org/', '_blank')" style="display:flex;align-items:center;gap:6px;background:#f7fafd;color:#1976d2;border:1.5px solid #1976d2;border-radius:7px;padding:5px 12px;font-size:0.98em;cursor:pointer;">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;"><circle cx="10" cy="10" r="9" stroke="#1976d2" stroke-width="2"/><path d="M10 14V6M10 6L7 9M10 6l3 3" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            رفع الصورة الشخصية
          </button>
        </div>
        <div style="margin-bottom:12px;">
          <label>رابط صورة شخصية:</label>
          <input id="modal-instructor-img" type="text" style="width:100%;padding:6px;margin-top:4px;">
        </div>
        <!-- زر رفع صورة الكورس -->
        <div style="margin-bottom:4px;">
          <button type="button" onclick="window.open('https://postimages.org/', '_blank')" style="display:flex;align-items:center;gap:6px;background:#f7fafd;color:#1976d2;border:1.5px solid #1976d2;border-radius:7px;padding:5px 12px;font-size:0.98em;cursor:pointer;">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;"><circle cx="10" cy="10" r="9" stroke="#1976d2" stroke-width="2"/><path d="M10 14V6M10 6L7 9M10 6l3 3" stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            رفع صورة الكورس
          </button>
        </div>
        <div style="margin-bottom:12px;">
          <label>رابط صورة الكورس:</label>
          <input id="modal-course-img" type="text" style="width:100%;padding:6px;margin-top:4px;">
        </div>
        <div style="margin-bottom:12px;">
          <label>وصف الكورس:</label>
          <textarea id="modal-course-info" style="width:100%;padding:6px;margin-top:4px;" rows="3"></textarea>
        </div>
        <!-- إضافة: حقل المفتاح -->
        <div style="margin-bottom:12px;">
          <label>المفتاح:</label>
          <input id="modal-youtube-api-key" type="text" style="width:100%;padding:6px;margin-top:4px;">
        </div>
        <div style="margin-bottom:12px;">
          <label>سعر الكورس:</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input id="modal-course-price" type="text" style="width:100%;padding:6px;margin-top:4px;">
            <span style="white-space:nowrap;margin-top:4px;">جنية</span>
          </div>
        </div>
      </div>
      <div style="text-align:center;">
        <button type="submit" id="modal-save-btn" style="padding:6px 18px;">حفظ</button>
        <button type="button" onclick="closeModal()" style="padding:6px 18px;">إلغاء</button>
      </div>
    </form>
  </div>
</div>

<!-- Image Preview Modal for Course Image -->
<div id="img-preview-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000b;z-index:2000;justify-content:center;align-items:center;">
  <span onclick="closeImgPreview()" style="position:absolute;top:18px;left:24px;font-size:2em;color:#fff;cursor:pointer;z-index:2010;">&times;</span>
  <img id="img-preview" src="" alt="صورة" style="max-width:90vw;max-height:80vh;border-radius:10px;box-shadow:0 2px 16px #0008;">
</div>
<!-- Image Preview Modal for Instructor Image -->
<div id="instructor-img-preview-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000b;z-index:2000;justify-content:center;align-items:center;">
  <span onclick="closeInstructorImgPreview()" style="position:absolute;top:18px;left:24px;font-size:2em;color:#fff;cursor:pointer;z-index:2010;">&times;</span>
  <img id="instructor-img-preview" src="" alt="صورة شخصية" style="max-width:60vw;max-height:60vh;border-radius:50%;box-shadow:0 2px 16px #0008;">
</div>
<!-- Plyr Video Player Modal -->
<div id="video-player-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:4000;justify-content:center;align-items:center;background:#000b;">
    <div style="position:relative;max-width:96vw;max-height:80vh;width:100%;display:flex;flex-direction:column;align-items:center;">
        <span id="exit-video-button" onclick="closeVideoPlayer(event)" style="display:none;position:absolute;top:18px;left:24px;font-size:2em;color:#fff;cursor:pointer;z-index:4010;background:#1976d2cc;border-radius:50%;padding:2px 12px;">خروج</span>
        <div id="watermark" style="position:absolute;top:24px;right:24px;z-index:4020;font-size:1.1em;color:#1976d2;pointer-events:none;opacity:0.3;display:none;"></div>
        <div style="width:100%;height:100%;display:flex;justify-content:center;align-items:center;">
            <div class="plyr__video-embed" id="plyr-video-embed" style="width:70vw;max-width:900px;aspect-ratio:16/9;">
                <iframe id="video-player-iframe" allowfullscreen allow="autoplay" style="width:100%;height:100%;border-radius:12px;border:none;display:block;"></iframe>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.min.js"></script>
<script src="firebase-auth.js"></script>
<script src="ui-render.js"></script>
<script src="file-manager.js"></script>
<script src="ui.js"></script>
<script src="mediaPreviewHandler.js"></script>
</body>
</html>
